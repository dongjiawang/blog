<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>UIView 的 layer - 我的码</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="dongjiawang"><meta name=description content="iOS 中能看得见的控件基本都是 UIView，比如按钮、文本、输入框、图片等等。 UIView 之所以能显示在屏幕上，因为它内部有一个图层：CALayer 1 @property(nonatomic,readonly,retain) CALayer"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.101.0 with theme even"><link rel=canonical href=https://blog.dongjiawang.top/post/2017-11-29-uiview-layer/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.cb68f97bc9cece255d217346d970e3c62623408634e500c330a62fadabbbe77c.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="UIView 的 layer"><meta property="og:description" content="iOS 中能看得见的控件基本都是 UIView，比如按钮、文本、输入框、图片等等。 UIView 之所以能显示在屏幕上，因为它内部有一个图层：CALayer 1 @property(nonatomic,readonly,retain) CALayer"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.dongjiawang.top/post/2017-11-29-uiview-layer/"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-11-29T23:30:00+00:00"><meta property="article:modified_time" content="2017-11-29T23:30:00+00:00"><meta itemprop=name content="UIView 的 layer"><meta itemprop=description content="iOS 中能看得见的控件基本都是 UIView，比如按钮、文本、输入框、图片等等。 UIView 之所以能显示在屏幕上，因为它内部有一个图层：CALayer 1 @property(nonatomic,readonly,retain) CALayer"><meta itemprop=datePublished content="2017-11-29T23:30:00+00:00"><meta itemprop=dateModified content="2017-11-29T23:30:00+00:00"><meta itemprop=wordCount content="1527"><meta itemprop=keywords content="UIView,"><meta name=twitter:card content="summary"><meta name=twitter:title content="UIView 的 layer"><meta name=twitter:description content="iOS 中能看得见的控件基本都是 UIView，比如按钮、文本、输入框、图片等等。 UIView 之所以能显示在屏幕上，因为它内部有一个图层：CALayer 1 @property(nonatomic,readonly,retain) CALayer"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>我的码</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>首页</li></a><a href=/post/><li class=mobile-menu-item>归档</li></a><a href=/tags/><li class=mobile-menu-item>标签</li></a><a href=/categories/><li class=mobile-menu-item>分类</li></a><a href=/about/><li class=mobile-menu-item>关于</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>我的码</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>首页</a></li><li class=menu-item><a class=menu-item-link href=/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=/about/>关于</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>UIView 的 layer</h1><div class=post-meta><span class=post-time>2017-11-29</span><div class=post-category><a href=/categories/ios/>iOS</a></div><span class=more-meta>约 1527 字</span>
<span class=more-meta>预计阅读 4 分钟</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#添加图层>添加图层</a></li><li><a href=#图层绘制>图层绘制</a></li><li><a href=#动画>动画</a></li></ul></li></ul></li></ul></nav></div></div><div class=post-content><p>iOS 中能看得见的控件基本都是 UIView，比如按钮、文本、输入框、图片等等。</p><p>UIView 之所以能显示在屏幕上，因为它内部有一个图层：<code>CALayer</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=k>@property</span><span class=p>(</span><span class=k>nonatomic</span><span class=p>,</span><span class=k>readonly</span><span class=p>,</span><span class=k>retain</span><span class=p>)</span> <span class=n>CALayer</span> <span class=o>*</span><span class=n>layer</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>当 UIView 显示在屏幕上的时候，会调用 <code>drawRect:</code> 方法进行绘图，会将所有的内容绘制在自己的图层上，绘制完毕后，系统会将图层拷贝到屏幕上，于是 UIView 就显示了出来。</p><p>通过下面的方法可以获取到 view 的图层。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>CALayer</span> <span class=o>*</span><span class=n>layer</span> <span class=o>=</span> <span class=nb>self</span><span class=p>.</span><span class=n>view</span><span class=p>.</span><span class=n>layer</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>一个 UIView 只有一个 layer 属性，但是 layer 是可以叠加的，多个 layer 叠加在一起就构成了一个组合图像。</p><h3 id=添加图层>添加图层</h3><p>一个图层可以有多个子图层。在绘制屏幕的时候，子图层可以被排列后固定在一起。</p><p>比如游戏图层，一个绘制背景，一个绘制角色，一个绘制地图。</p><p>可以为每个图层准备一个专门的 UIView，然后用另外一个 UIView 来整合图层：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=c1>// 整合的 UIView 类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>UIView</span> <span class=o>*</span><span class=n>gameView</span> <span class=o>=</span> <span class=p>[[</span><span class=n>UIView</span> <span class=n>alloc</span><span class=p>]</span><span class=nl>initWithFrame</span><span class=p>:[[</span><span class=n>UIScreen</span> <span class=n>mainScreen</span><span class=p>]</span> <span class=n>applicationFrame</span><span class=p>]];</span>  
</span></span><span class=line><span class=cl><span class=c1>// 背景图层
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>UIView</span> <span class=o>*</span><span class=n>backgroundView</span> <span class=o>=</span> <span class=p>[[</span><span class=n>UIView</span> <span class=n>alloc</span><span class=p>]</span> <span class=nl>initWithFrame</span><span class=p>:[[</span><span class=n>UIScreen</span> <span class=n>mainScreen</span><span class=p>]</span> <span class=n>applicationFrame</span><span class=p>]];</span>  
</span></span><span class=line><span class=cl><span class=c1>// 角色图层
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>UIView</span> <span class=o>*</span><span class=n>roleView</span><span class=o>=</span> <span class=p>[[</span><span class=n>UIView</span> <span class=n>alloc</span><span class=p>]</span> <span class=nl>initWithFrame</span><span class=p>:</span><span class=n>CGRectMake</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>100.0</span><span class=p>,</span> <span class=mf>200.0</span><span class=p>)];</span>  
</span></span><span class=line><span class=cl><span class=c1>// 地图图层
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>UIView</span> <span class=o>*</span><span class=n>mapView</span> <span class=o>=</span> <span class=p>[[</span><span class=n>UIView</span> <span class=n>alloc</span><span class=p>]</span> <span class=nl>initWithFrame</span><span class=p>:</span><span class=n>CGRectMake</span><span class=p>(</span><span class=mf>200.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>100.0</span><span class=p>,</span> <span class=mf>100.0</span><span class=p>)];</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//通过CALayer 类的addSublayer 方法，可以将3个UIView 类的图层全都与 gameView 对象链接在一起 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>CALayer</span><span class=o>*</span> <span class=n>gameLayer</span> <span class=o>=</span> <span class=n>gameView</span><span class=p>.</span><span class=n>layer</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>gameLayer</span> <span class=nl>addSublayer</span><span class=p>:</span><span class=n>backgroundView</span><span class=p>.</span><span class=n>layer</span><span class=p>];</span>  
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>gameLayer</span> <span class=nl>addSublayer</span><span class=p>:</span><span class=n>roleView</span><span class=p>.</span><span class=n>layer</span><span class=p>];</span>  
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>gameLayer</span> <span class=nl>addSublayer</span><span class=p>:</span><span class=n>mapView</span><span class=p>.</span><span class=n>layer</span><span class=p>];</span> 
</span></span></code></pre></td></tr></table></div></div><p>当 gameView 对象显示在屏幕上的时候，3个子图层被合并在一起绘制出来。每个类单独绘制他自己的图层，但当游戏图层被显示出来的时候，3个图层就全都融合在一起了。</p><p>子图层也可以添加自己的子图层，并且可以构建一个完整的图层层次结构。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=c1>//mapView图层中再构加入一个图层，用来显示剩余里程数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>UILabel</span> <span class=o>*</span><span class=n>lastDistance</span> <span class=o>=</span> <span class=p>[[</span><span class=n>UILabel</span> <span class=n>alloc</span><span class=p>]</span> <span class=nl>initWithFrame</span><span class=p>:</span><span class=n>CGRectMake</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>20.0</span><span class=p>,</span> <span class=mf>20.0</span><span class=p>)];</span>  
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>mapView</span><span class=p>.</span><span class=n>layer</span> <span class=nl>addSublayer</span><span class=p>:</span><span class=n>lastDistance</span><span class=p>.</span><span class=n>layer</span><span class=p>];</span> 
</span></span></code></pre></td></tr></table></div></div><p>通过设置图层的position属性，你还可以不用改变图层的大小就对其位置进行调整。这个属性接受一个CGPoint 结构体，来定位图层在屏幕上的偏移位置。与frame 属性不同，position 属性指定的是图层的重点，而不是左上角：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>CGPoint</span> <span class=n>lastDistancePosition</span> <span class=o>=</span> <span class=n>CGPointMake</span><span class=p>(</span><span class=mf>100.0</span><span class=p>,</span> <span class=mf>100.0</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=n>lastDistance</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>lastDistancePosition</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以使用 <code>addSublayer</code>讲图层添加到其他图层的顶层，也可以使用 <code>insertSublayer</code>将图层插入到现有的图层之间。</p><p>使用 <code>avove</code> 或者 <code>below</code> 参数，可以将图层插入到指定图层的上面或者下面：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=p>[</span><span class=n>gamelayer</span> <span class=nl>insertSublayer</span><span class=p>:</span><span class=n>mapView</span><span class=p>.</span><span class=n>layer</span> <span class=nl>below</span><span class=p>:</span><span class=n>backgroundView</span><span class=p>.</span><span class=n>layer</span><span class=p>];</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>gamelayer</span> <span class=nl>insertSublayer</span><span class=p>:</span><span class=n>mapView</span><span class=p>.</span><span class=n>layer</span> <span class=nl>above</span><span class=p>:</span><span class=n>roleView</span><span class=p>.</span><span class=n>layer</span><span class=p>];</span> 
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>removeFromSuperlayer</code> 方法可以将图层从父图层上移除。</p><p>使用 <code>replaceSublayer</code> 可以替换某个图层</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=p>[</span><span class=n>gamelayer</span> <span class=nl>replaceSublayer</span><span class=p>:</span><span class=n>backgroundView</span><span class=p>.</span><span class=n>layer</span> <span class=nl>with</span><span class=p>:</span><span class=n>newBackgroundView</span><span class=p>.</span><span class=n>layer</span> <span class=p>];</span> 
</span></span></code></pre></td></tr></table></div></div><p>layer 同样有 hidden 属性，可以保留在父图层的同时，将它隐藏。</p><h3 id=图层绘制>图层绘制</h3><p>在更新一个图层时，变化不是立刻被绘制在屏幕上的。这样就可以对图层做很多写操作而不会被展示给用户，直到所有的操作全部结束为止。当图层准备好可以进行重画时，就调用图层的 <code>setNeedsDisplay</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=p>[</span><span class=n>gamelayer</span> <span class=n>setNeedsDisplsy</span><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><p>有时候不需要重绘整个图层，只需要重新绘制某一部分，就可以使用 <code>setNeedsDisplayInRect:</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>CGRect</span> <span class=n>mapViewFrame</span> <span class=o>=</span> <span class=n>CGRectMake</span><span class=p>(</span><span class=mf>150.0</span><span class=p>,</span> <span class=mf>150.0</span><span class=p>,</span> <span class=mf>75.0</span><span class=p>,</span> <span class=mf>75.0</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>gameLayer</span> <span class=nl>setNeedsDisplayInRect</span><span class=p>:</span><span class=n>mapViewFrame</span><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><p>可以使用 <code>transform</code> 或者 <code>affineTransform</code> 属性对 layer 进行变换</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>roleview</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>transform</span> <span class=o>=</span> <span class=n>CATransform3DMakeScale</span><span class=p>(</span><span class=o>-</span><span class=mf>1.0</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=n>CGAffineTransform</span> <span class=n>transform</span> <span class=o>=</span> <span class=n>CGAffineTransformMakeRotation</span><span class=p>(</span><span class=mf>45.0</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=n>backgroundView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>affineTransform</span> <span class=o>=</span> <span class=n>transform</span> <span class=p>;</span> 
</span></span></code></pre></td></tr></table></div></div><h3 id=动画>动画</h3><p>结合 <code>Core Animation</code> 可以创建出很多的动画效果。</p><p>例如转场动画：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>CATransition</span><span class=o>*</span> <span class=n>animation</span> <span class=o>=</span> <span class=p>[[</span><span class=n>CATransition</span> <span class=n>alloc</span><span class=p>]</span><span class=n>init</span><span class=p>];</span>  
</span></span><span class=line><span class=cl> <span class=n>animation</span><span class=p>.</span><span class=n>duration</span> <span class=o>=</span><span class=mf>1.0</span><span class=p>;</span>  
</span></span><span class=line><span class=cl> <span class=n>animation</span><span class=p>.</span><span class=n>timingFunction</span> <span class=o>=</span> <span class=p>[</span><span class=n>CAMediaTimingFunction</span> <span class=nl>functionWithName</span><span class=p>:</span><span class=n>kCAMediaTimingFunctionEaseIn</span><span class=p>];</span>  
</span></span><span class=line><span class=cl> <span class=n>animation</span><span class=p>.</span><span class=n>type</span> <span class=o>=</span> <span class=n>kCATransitionPush</span><span class=p>;</span>  
</span></span><span class=line><span class=cl> <span class=n>animation</span><span class=p>.</span><span class=n>subtype</span> <span class=o>=</span> <span class=n>kCATransitionFromRight</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>CABasicAnimation</code> 旋转动画</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>CABasicAnimation</span> <span class=o>*</span><span class=n>animation</span> <span class=o>=</span> <span class=p>[</span><span class=n>CABasicAnimation</span> <span class=nl>animationWithKeyPath</span><span class=p>:</span><span class=s>@&#34;transform&#34;</span><span class=p>];</span>  
</span></span><span class=line><span class=cl><span class=n>animation</span><span class=p>.</span><span class=n>toValue</span> <span class=o>=</span> <span class=p>[</span><span class=n>NSValue</span> <span class=nl>valueWithCATransform3D</span><span class=p>:</span><span class=n>CATransform3DMakeRotation</span><span class=p>(</span><span class=mf>3.1415</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)];</span>  
</span></span><span class=line><span class=cl><span class=n>animation</span><span class=p>.</span><span class=n>duration</span> <span class=o>=</span> <span class=mf>3.0</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=n>animation</span><span class=p>.</span><span class=n>cumulative</span> <span class=o>=</span> <span class=nb>YES</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=n>animation</span><span class=p>.</span><span class=n>repeatCount</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> 
</span></span></code></pre></td></tr></table></div></div><p>创建好之后，你可以直接将动画或者转场应用到一个图层上</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=p>[</span><span class=n>mapView</span><span class=p>.</span><span class=n>layer</span> <span class=nl>addAnimation</span><span class=p>:</span><span class=n>animation</span> <span class=nl>forKey</span><span class=p>:</span><span class=s>@&#34;animation&#34;</span><span class=p>];</span>  
</span></span></code></pre></td></tr></table></div></div><p><code>Quartz Core</code> 的渲染能力可以像三维一样对二维图像进行任意操纵。一个图像可以在 <code>x-y-z</code> 三维轴上进行任意角度旋转、缩放和扭曲。</p><p>变换是在单独的图层上执行的，因此多个变换可以在一个图层表面上同时进行。</p><p><code>Quartz Core</code> 框架用 <code>CATransform3D</code> 对象来执行变换。这个对象作用于视图的图层，根据期望的三维设置对图层进行弯折或者其他操作。</p><p>对一个图层进行 3D 旋转：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>CATransform3D</span> <span class=n>myTransform</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=n>myTransform</span> <span class=o>=</span> <span class=n>CATransform3DMakeRotation</span><span class=p>(</span><span class=n>angle</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>);</span>  
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>CATransform3DMakeRotation</code> 函数创建了一个变换，对一个图形进行旋转，旋转角度<code>angle</code>单位为弧度，轴为 <code>x-y-z</code>。<code>x-y-z</code>的值定义了轴上在各个方向上的度量(介于-1和+1之间)。在一个轴上赋予值，就会指示变换绕该轴进行旋转。</p></blockquote><p>要将一个图层绕水平轴转动（垂直转动）45度，可以使用下面的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>myTransform</span> <span class=o>=</span> <span class=n>CATransform3DMakeRotation</span><span class=p>(</span><span class=mf>0.78</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//0.78 是角度45度换成弧度得到的  
</span></span></span></code></pre></td></tr></table></div></div><p>要在水平方向上转动同样的角度，可以换成 y 轴指定一个值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>myTransform</span> <span class=o>=</span> <span class=n>CATransform3DMakeRotation</span><span class=p>(</span><span class=mf>0.78</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>);</span> 
</span></span></code></pre></td></tr></table></div></div><p>CALayer 对象提供了一个 transform属性，可以用来将变换附加到图层之上。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-objectivec data-lang=objectivec><span class=line><span class=cl><span class=n>roleView</span><span class=p>.</span><span class=n>layer</span><span class=p>.</span><span class=n>transform</span> <span class=o>=</span> <span class=n>myTransform</span><span class=p>;</span> 
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><div class=post-tags><a href=/tags/uiview/>UIView</a></div><nav class=post-nav><a class=prev href=/post/2017-11-30-coreanimation-used/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">CoreAnimation 的简单使用</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/2017-11-28-uiwebview-gethtml/><span class="next-text nav-default">UIWebView简单的获取HTML内容和修改页面信息</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=weakself@foxmail.com class="iconfont icon-email" title=email></a>
<a href=https://github.com/dongjiawang class="iconfont icon-github" title=github></a>
<a href=https://space.bilibili.com/13834686 class="iconfont icon-bilibili" title=bilibili></a>
<a href=https://blog.dongjiawang.top/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2015 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>dongjiawang</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript>window.MathJax={tex:{}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-141040294-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script id=baidu_analytics>var _hmt=_hmt||[];(function(){if(window.location.hostname==="localhost")return;var t,e=document.createElement("script");e.async=!0,e.src="https://hm.baidu.com/hm.js?fa4bbb246def5e07ea71011a568aceaa",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>